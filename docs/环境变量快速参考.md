# 🚀 环境变量快速参考卡片

## 📦 文件清单

| 文件                         | 用途         | 提交到 Git | 环境   |
| ---------------------------- | ------------ | ---------- | ------ |
| `.env.example`               | 通用示例     | ✅ 是      | 所有   |
| `.env.local.example`         | 本地开发示例 | ✅ 是      | 开发   |
| `.env.local`                 | 本地开发配置 | ❌ 否      | 开发   |
| `.env.production.example`    | 生产示例     | ✅ 是      | 生产   |
| `.env.production`            | 生产配置     | ❌ 否      | 生产   |
| `docker/.env.docker.example` | Docker 示例  | ✅ 是      | Docker |
| `docker/.env.docker`         | Docker 配置  | ❌ 否      | Docker |

---

## ⚡ 快速开始（3 步）

### 步骤 1️⃣: 复制配置

```bash
cp .env.local.example .env.local
```

### 步骤 2️⃣: 启动 Docker

```bash
docker-compose up -d
```

### 步骤 3️⃣: 启动应用

```bash
pnpm dev
# 访问 http://localhost:3000
```

---

## 🔑 关键变量

### 数据库

```dotenv
DATABASE_URL=postgresql://user:password@host:5432/dbname
```

### 缓存

```dotenv
REDIS_URL=redis://[password@]host:6379/db
```

### AI 服务

```dotenv
AI_BASE_URL=http://127.0.0.1:10086/v1
AI_MODEL=chatglm3-6b
```

### 认证

```dotenv
JWT_SECRET=strong-random-32-chars-minimum
NEXTAUTH_SECRET=strong-random-32-chars-minimum
```

---

## 🛡️ 安全密钥生成

```bash
# 生成 JWT Secret
openssl rand -base64 32

# 生成 NextAuth Secret
openssl rand -base64 32

# 生成密码
openssl rand -base64 12
```

---

## ✅ 环境检查

### 开发环境

```bash
# 检查 Docker 容器
docker-compose ps

# 检查数据库连接
psql $DATABASE_URL -c "SELECT 1"

# 检查 Redis 连接
redis-cli -u $REDIS_URL ping

# 检查应用健康
curl http://localhost:3000/api/health
```

### 生产环境

```bash
# 检查是否有敏感信息
grep "REPLACE_WITH_" .env.production

# 检查密钥强度
[ ${#JWT_SECRET} -ge 32 ] && echo "✓"

# 检查 SSL 连接
echo $DATABASE_URL | grep "sslmode=require"
```

---

## 📋 配置分类表

### 应用基础

- `NODE_ENV` - 环境（development/production）
- `NEXT_PUBLIC_APP_URL` - 应用 URL
- `PORT` - 应用端口

### 数据库

- `DATABASE_URL` - PostgreSQL 连接
- `DATABASE_POOL_SIZE` - 连接池大小
- `DATABASE_CONNECTION_TIMEOUT` - 连接超时

### 缓存

- `REDIS_URL` - Redis 连接
- `REDIS_DB` - 数据库号
- `REDIS_CACHE_TTL` - 缓存 TTL

### 认证

- `JWT_SECRET` - JWT 密钥
- `NEXTAUTH_SECRET` - NextAuth 密钥
- `COOKIE_SECURE` - 安全 Cookie

### AI 模型

- `AI_BASE_URL` - AI 服务 URL
- `AI_MODEL` - 模型名称
- `AI_TEMPERATURE` - 温度参数
- `AI_MAX_TOKENS` - 最大令牌

### 外部服务

- `ZHIPU_API_KEY` - 智谱 API Key
- `OPENAI_API_KEY` - OpenAI API Key
- `SMTP_HOST` - 邮件 SMTP 服务器

### 文件存储

- `STORAGE_TYPE` - 存储类型（local/s3）
- `S3_BUCKET` - S3 桶名称
- `MAX_FILE_SIZE` - 最大文件大小

### 监控日志

- `LOG_LEVEL` - 日志级别
- `SENTRY_DSN` - Sentry 错误追踪
- `SLACK_WEBHOOK_URL` - Slack 通知

---

## 🐳 Docker Compose 命令

```bash
# 启动所有服务
docker-compose up -d

# 查看服务状态
docker-compose ps

# 查看服务日志
docker-compose logs -f

# 查看特定服务日志
docker-compose logs -f postgres
docker-compose logs -f redis

# 停止所有服务
docker-compose down

# 删除所有数据（谨慎）
docker-compose down -v

# 重启服务
docker-compose restart

# 在容器中执行命令
docker-compose exec postgres psql -U postgres -d yyc3_db
docker-compose exec redis redis-cli
```

---

## 🔄 环境切换

```bash
# 加载开发环境变量
export $(cat .env.local | xargs)

# 加载生产环境变量
export $(cat .env.production | xargs)

# 清空所有环境变量
unset $(cat .env.local | cut -d= -f1)
```

---

## 📊 环境对比

| 功能     | 开发      | 测试 | 预发布   | 生产     |
| -------- | --------- | ---- | -------- | -------- |
| 数据库   | 本地      | 本地 | 远程     | 远程集群 |
| Redis    | 本地      | 本地 | 远程     | 远程集群 |
| AI 服务  | 本地 vLLM | 本地 | 官方 API | 官方 API |
| SSL      | ❌        | ❌   | ✅       | ✅       |
| 备份     | ❌        | ❌   | ✅       | ✅       |
| 监控     | ✅        | ✅   | ✅       | ✅       |
| 日志级别 | debug     | info | info     | warn     |

---

## 🆘 常见问题速查

| 问题           | 解决方案                             |
| -------------- | ------------------------------------ |
| 无法连接数据库 | 检查 `DATABASE_URL`、Docker 容器状态 |
| Redis 连接失败 | 检查 `REDIS_URL`、Redis 容器是否运行 |
| AI 服务超时    | 检查 `AI_BASE_URL`、vLLM 服务状态    |
| 邮件发送失败   | 检查 `SMTP_*` 配置、防火墙设置       |
| 文件上传失败   | 检查 `STORAGE_*` 配置、权限设置      |
| 身份验证失败   | 检查 `JWT_SECRET`、`NEXTAUTH_SECRET` |
| 性能缓慢       | 检查 `DATABASE_POOL_SIZE`、缓存配置  |

---

## 🔒 安全清单

- [ ] 本地 `.env.local` 不提交到 Git
- [ ] 生产 `.env.production` 不提交到 Git
- [ ] 所有密钥长度 >= 32 字符
- [ ] 生产环境使用 SSL/TLS 连接
- [ ] 生产环境使用密钥管理服务
- [ ] 日志不包含敏感信息
- [ ] 定期轮换密钥（90 天）
- [ ] 启用数据库备份
- [ ] 启用监控和告警
- [ ] 启用审计日志

---

## 📚 文档链接

- 📖 完整指南：[环境变量配置指南.md](环境变量配置指南.md)
- 📋 项目主文档：[README.md](../README.md)
- 🚀 部署指南：[YYC3-AI-Call-DEPLOYMENT.md](YYC3-AI-Call-DEPLOYMENT.md)
- 🔄 CI/CD 配置：[YYC3-AI-Call-CICD.md](YYC3-AI-Call-CICD.md)

---

**快速参考版本**: v1.0  
**最后更新**: 2026-01-23  
**维护团队**: YYC³ Team
